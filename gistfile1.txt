<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å€«æ•¦å¾©å¤æ—…éŠæ‰‹å†Š - London Travel Guide</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        /* ğŸ¨ Custom Tailwind Configuration for Vintage Style */
        :root {
            --color-vintage-primary: #8B0000; /* æ·±ç´…/å‹ƒæ ¹åœ°ç´… - Accent Color */
            --color-vintage-secondary: #0A1931; /* æµ·è»è—/åˆå¤œè— - Dark Text/Background */
            --color-vintage-light: #F4F0E4; /* å¥¶æ²¹ç™½/ç±³ç™½ - Paper/Card Background */
            --color-vintage-accent: #B8860B; /* æš—é‡‘è‰² - Subtle Highlight */
        }

        /* è¨­ç½®å…¨å±€å­—é«” */
        body {
            font-family: 'Lato', sans-serif;
            background-color: var(--color-vintage-secondary); /* æ·±è—èƒŒæ™¯ */
            color: var(--color-vintage-secondary); /* é è¨­æ–‡å­—é¡è‰² */
        }

        /* æ¨™é¡Œå­—é«” */
        .font-display {
            font-family: 'Playfair Display', serif;
        }

        /* è‡ªè¨‚ Tailwind é¡è‰² */
        .bg-vintage-light { background-color: var(--color-vintage-light); }
        .text-vintage-primary { color: var(--color-vintage-primary); }
        .border-vintage-primary { border-color: var(--color-vintage-primary); }
        .bg-vintage-primary { background-color: var(--color-vintage-primary); }
        .bg-vintage-secondary { background-color: var(--color-vintage-secondary); }

        /* å¡ç‰‡èˆ‡æŒ‰éˆ•çš„å¾©å¤æ¨£å¼ */
        .vintage-card {
            background-color: var(--color-vintage-light);
            border: 2px solid var(--color-vintage-primary);
            border-radius: 12px;
            box-shadow: 6px 6px 0px 0px rgba(139, 0, 0, 0.7); /* æ·±ç´…é™°å½± */
        }

        .vintage-button {
            background-color: var(--color-vintage-primary);
            color: var(--color-vintage-light);
            border-radius: 9999px; /* è† å›Šç‹€ */
            box-shadow: 2px 2px 0px 0px rgba(0, 0, 0, 0.5);
            transition: transform 0.1s;
        }

        .vintage-button:active {
            transform: translate(1px, 1px);
            box-shadow: 1px 1px 0px 0px rgba(0, 0, 0, 0.5);
        }

        /* è¡Œç¨‹æ™‚é–“è»¸å°ˆç”¨æ¨£å¼ */
        .timeline-line {
            width: 2px;
            background-color: var(--color-vintage-primary);
            margin: 0 auto;
        }
        .timeline-dot {
            width: 12px;
            height: 12px;
            background-color: var(--color-vintage-primary);
            border: 2px solid var(--color-vintage-light);
            border-radius: 50%;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
        }
    </style>
</head>

<body class="min-h-screen pt-12 pb-20">

    <header class="fixed top-0 left-0 right-0 bg-vintage-primary text-vintage-light shadow-xl z-20">
        <div class="p-3 text-center">
            <h1 id="app-title" class="text-xl font-display font-bold">ğŸ‡¬ğŸ‡§ å€«æ•¦å¾©å¤æ—…éŠæ‰‹å†Š</h1>
        </div>
    </header>

    <main class="p-4 pt-0">
        <div id="plan-page" class="tab-content"></div>
        <div id="guide-page" class="tab-content hidden"></div>
        <div id="wallet-page" class="tab-content hidden"></div>
        <div id="lists-page" class="tab-content hidden"></div>
        <div id="info-page" class="tab-content hidden"></div>
    </main>

    <nav class="fixed bottom-0 left-0 right-0 bg-vintage-secondary border-t-2 border-vintage-primary shadow-2xl z-20">
        <ul class="flex justify-around items-center h-16 text-vintage-light">
            <li class="nav-item flex flex-col items-center p-2 cursor-pointer" data-target="plan-page"><i class="fas fa-map-marked-alt text-xl"></i><span class="text-xs mt-1">PLAN</span></li>
            <li class="nav-item flex flex-col items-center p-2 cursor-pointer" data-target="guide-page"><i class="fas fa-book-open text-xl"></i><span class="text-xs mt-1">GUIDE</span></li>
            <li class="nav-item flex flex-col items-center p-2 cursor-pointer" data-target="wallet-page"><i class="fas fa-wallet text-xl"></i><span class="text-xs mt-1">WALLET</span></li>
            <li class="nav-item flex flex-col items-center p-2 cursor-pointer" data-target="lists-page"><i class="fas fa-list-check text-xl"></i><span class="text-xs mt-1">LISTS</span></li>
            <li class="nav-item flex flex-col items-center p-2 cursor-pointer" data-target="info-page"><i class="fas fa-info-circle text-xl"></i><span class="text-xs mt-1">INFO</span></li>
        </ul>
    </nav>

    <script>
        // ====================================================================
        // æ ¸å¿ƒè³‡æ–™çµæ§‹
        // ====================================================================

        const TRAVEL_DATA = {
            exchangeRate: 39.0, // é è¨­åŒ¯ç‡ (1 è‹±éŠ = 39.0 å°å¹£)
            city: "London",
            schedule: [
                {
                    day: "Day1 12/23",
                    events: [
                        { time: "11:00", name: "Airbnb", description: "check-in è¡Œæå®‰ç½®", mapLink: "https://maps.apple/p/ZVVwnoXbs9xEvZ", transport: "11:30å‰å‡ºç™¼, 30min", important: true },
                        { time: "12:00", name: "è¥¿æ•å¯º (Westminster Abbey)", description: "ç•¶å ´è²·ç¥¨ã€‚å¿…åˆ°ï¼", mapLink: "https://maps.apple/p/YFI8rf8dZ1riWW", transport: "Bus24 30min", important: true },
                        { time: "14:00", name: "å¤§è‹±åšç‰©é¤¨ (British Museum)", description: "å…è²»åƒè§€, æ³¨æ„é–‹æ”¾æ™‚é–“ã€‚", mapLink: "https://maps.apple/p/VWrIiL1CAvzCLo", transport: "Bus8/Tube 20min" },
                        { time: "16:00", name: "è–ä¿ç¾…æ•™å ‚ (St Paul's Cathedral)", description: "ç™»é ‚æ¬£è³åŸå¸‚é¢¨æ™¯ã€‚", mapLink: "https://maps.apple/p/gRQPLpyyZvTmpJ", transport: "Tube 10min" },
                        { time: "17:30", name: "æ³¢ç¾…å¸‚å ´ (Borough Market)", description: "é€›è¡—è¦“é£Ÿ, é è¿‘å€«æ•¦æ©‹ã€‚", mapLink: "https://maps.apple/p/jsLCcc42_huIuo", transport: "Walk 2min" },
                        { time: "18:00", name: "å€«æ•¦æ©‹ (London Bridge)", description: "æ‹ç…§ç•™å¿µã€‚", mapLink: "https://maps.apple/p/iV2jfw_mFj5cUn", transport: "Walk 15min" },
                        { time: "18:30", name: "å€«æ•¦å¡”æ©‹ (Tower Bridge)", description: "é–€ç¥¨ Â£12/1perã€‚å¤œæ™¯å¾ˆç¾ã€‚", mapLink: "https://maps.apple/p/Lmt.M3jDBDWa3a", transport: "Walk 5min" },
                        { time: "19:00", name: "å€«æ•¦å¡” (Tower of London)", description: "å¤è€çš‡å®¤è¦å¡ã€‚", mapLink: "https://maps.apple/p/G4cR27STkEGcVY", transport: "Walk 14min" },
                        { time: "20:00", name: "Skylight Peckham Bar", description: "é ‚æ¨“é…’å§æ”¾é¬†", mapLink: "https://maps.apple/p/IKf8mzPH8r2TWI", transport: "Walk 10min" },
                        { time: "21:00", name: "ç™½æ•™å ‚ (Whitechapel)", description: "å°‹æ‰¾é–‹è†›æ‰‹å‚‘å…‹çš„è¶³è·¡", mapLink: "https://maps.apple/p/fkyCRE~xMggb2N", transport: "Tube/Bus 20~25min" },
                        { time: "22:00", name: "åƒç¦§æ©‹ (Millennium Bridge)", description: "é€šå¾€æ³°ç‰¹ç¾ä»£ç¾è¡“é¤¨ã€‚", mapLink: "https://maps.apple/p/K_hJqa.cZaynS~", transport: "Bus 13min / Walk16min" },
                        { time: "23:00", name: "Dinner - Flat Iron Steak", description: "äº«ç”¨ç¾å‘³ç‰›æ’", mapLink: "https://maps.apple/p/wBZPrnAjWhkE8G", transport: "å›ç¨‹" },
                    ]
                },
                {
                    day: "Day2 12/24",
                    events: [
                        { time: "09:30", name: "ç™½é‡‘æ¼¢å®® (Buckingham Palace)", description: "è§€çœ‹è¡›å…µäº¤æ¥å„€å¼", mapLink: "https://maps.apple/p/gqy.gETMfU~Aid", transport: "Tube 30min", important: true },
                        { time: "11:00", name: "å¤§ç¬¨é˜ (Big Ben) & åœ‹æœƒå¤§å»ˆ", description: "ç¶“å…¸åœ°æ¨™ã€‚", mapLink: "https://maps.apple/p/TNaFqyf4f78nfk", transport: "Walk 18min" },
                        { time: "12:00", name: "å€«æ•¦çœ¼ (London Eye)", description: "å€«æ•¦å…¨æ™¯ï¼Œå¯è€ƒæ…®æ­ä¹˜ã€‚", mapLink: "https://maps.apple/p/CX65Paqhar11Tv", transport: "Walk 10min" },
                        { time: "13:30", name: "ç‰¹æ‹‰æ³•åŠ å»£å ´ (Trafalgar Square)", description: "åœ‹å®¶ç•«å»Šæ‰€åœ¨åœ°ã€‚", mapLink: "https://maps.apple/p/Id~gWnr6uLEbB-", transport: "Walk 16min" },
                        { time: "14:30", name: "èŠæ–¯ç‰¹å»£å ´ (Leicester Square)", description: "é›»å½±é™¢ã€åŠ‡é™¢å€ã€‚", mapLink: "https://maps.apple/p/iyfBRoTrYA06T4", transport: "Walk 5min" },
                        { time: "15:00", name: "ä¸­åœ‹åŸ (Chinatown)", description: "åƒåˆé¤æˆ–é»å¿ƒã€‚", mapLink: "https://maps.apple/p/DHAvimxCwaaxQA", transport: "Walk 5min" },
                        { time: "16:00", name: "Sohoå€", description: "å’–å•¡é¤¨ã€é…’å§ã€ç²¾å“åº—ã€‚", mapLink: "https://maps.apple/p/82qo__JeuKw_dk", transport: "Walk 8min" },
                        { time: "17:00", name: "æ”æ”¿è¡— (Regent Street)", description: "è–èª•ç‡ˆé£¾å¿…çœ‹ï¼", mapLink: "https://maps.apple/p/kI.HBjR-oZWT_r", transport: "Walk 6min" },
                        { time: "18:00", name: "ç‰›æ´¥è¡— (Oxford Street)", description: "æ­æ´²æœ€ç¹å¿™çš„è³¼ç‰©è¡—ä¹‹ä¸€ã€‚", mapLink: "https://maps.apple/p/gX9yrfq4xUb5wt", transport: "Walk 5min" },
                        { time: "19:30", name: "æŸ¯èŠ¬åœ’ (Covent Garden)", description: "è¡—é ­è—äººè¡¨æ¼”ã€‚", mapLink: "https://maps.apple/p/e_bf8QcrVuI1uc", transport: "Walk 15min" },
                    ]
                }
            ],
            checkList: [
                { id: 1, text: "è­·ç…§ã€ç°½è­‰", done: false },
                { id: 2, text: "è‹±éŠç¾é‡‘ã€ä¿¡ç”¨å¡", done: false },
                { id: 3, text: "ç¶²å¡/E-sim", done: false },
                { id: 4, text: "è‹±åœ‹è½‰æ¥é ­ã€å……é›»å™¨", done: false },
                { id: 5, text: "å†¬å­£ä¿æš–è¡£ç‰©ã€åœå·¾ã€æ‰‹å¥—", done: false },
                { id: 6, text: "æ—…éŠä¿éšªè³‡æ–™å½±æœ¬", done: false },
            ],
            memos: [], // æ ¼å¼: { id: Date.now(), text: "å‚™å¿˜éŒ„å…§å®¹" }
            expenses: [] // æ ¼å¼: { id: Date.now(), item: "å“é …", gbp: 12.5, twd: 487.5, image: "base64 string" }
        };

        // ====================================================================
        // LocalStorage è®€å–èˆ‡å„²å­˜
        // ====================================================================

        function loadData() {
            const storedExpenses = localStorage.getItem('travelApp_expenses');
            if (storedExpenses) {
                TRAVEL_DATA.expenses = JSON.parse(storedExpenses);
            }
            const storedRate = localStorage.getItem('travelApp_exchangeRate');
            if (storedRate) {
                TRAVEL_DATA.exchangeRate = parseFloat(storedRate);
            }
            const storedCheckList = localStorage.getItem('travelApp_checkList');
            if (storedCheckList) {
                TRAVEL_DATA.checkList = JSON.parse(storedCheckList);
            }
            const storedMemos = localStorage.getItem('travelApp_memos');
            if (storedMemos) {
                TRAVEL_DATA.memos = JSON.parse(storedMemos);
            }
        }

        function saveData(key, data) {
            localStorage.setItem(`travelApp_${key}`, JSON.stringify(data));
        }

        // ====================================================================
        // é é¢åˆ‡æ›é‚è¼¯
        // ====================================================================

        const tabContents = document.querySelectorAll('.tab-content');
        const navItems = document.querySelectorAll('.nav-item');

        function switchTab(targetId) {
            tabContents.forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(targetId).classList.remove('hidden');

            // æ›´æ–°å°èˆªåˆ— active ç‹€æ…‹ (ç°¡å–®çš„é¡è‰²åˆ‡æ›)
            navItems.forEach(item => {
                item.classList.remove('text-vintage-primary');
                if (item.getAttribute('data-target') === targetId) {
                    item.classList.add('text-vintage-primary');
                }
            });

            // æ ¹æ“šåˆ‡æ›çš„é é¢åŸ·è¡Œæ¸²æŸ“
            if (targetId === 'plan-page') renderPlanPage();
            if (targetId === 'guide-page') renderGuidePage();
            if (targetId === 'wallet-page') renderWalletPage();
            if (targetId === 'lists-page') renderListsPage();
            if (targetId === 'info-page') renderInfoPage();
        }

        navItems.forEach(item => {
            item.addEventListener('click', (e) => {
                const target = e.currentTarget.getAttribute('data-target');
                switchTab(target);
            });
        });

        // ====================================================================
        // 1. PLAN (è¡Œç¨‹è¡¨) æ¸²æŸ“
        // ====================================================================

        function renderPlanPage() {
            let html = `<h2 class="text-3xl font-display text-vintage-light mt-4 mb-6 border-b-2 border-vintage-accent pb-2">ğŸ—ºï¸ ${TRAVEL_DATA.city} è¡Œç¨‹è¡¨</h2>`;

            TRAVEL_DATA.schedule.forEach(daySchedule => {
                html += `<div class="mb-8 p-3 vintage-card">
                            <h3 class="text-2xl font-display text-vintage-primary border-b border-gray-300 pb-1 mb-4">${daySchedule.day}</h3>
                            <div class="relative">`;

                daySchedule.events.forEach((event, index) => {
                    const isImportant = event.important ? 'bg-red-500 text-white' : 'bg-vintage-light';
                    const importantText = event.important ? '<span class="ml-2 px-2 py-0.5 text-xs font-bold rounded-full bg-red-500 text-white">é‡è¦</span>' : '';
                    const mapButton = `
                        <a href="${event.mapLink}" target="_blank" class="vintage-button inline-block text-xs px-3 py-1 mt-2 mr-2">
                            <i class="fas fa-location-dot"></i> åœ°åœ–
                        </a>
                    `;

                    html += `
                        <div class="mb-6 relative pl-8">
                            <div class="absolute left-0 top-0 bottom-0 w-1 bg-vintage-primary"></div>
                            <div class="absolute left-0 ${isImportant} w-3 h-3 rounded-full border-2 border-vintage-light mt-1" style="transform: translateX(-50%);"></div>

                            <div class="vintage-card p-3 shadow-md">
                                <p class="text-sm font-bold text-vintage-primary">${event.time} ${importantText}</p>
                                <p class="text-lg font-display font-semibold mt-1">${event.name}</p>
                                <p class="text-xs text-gray-600 mb-2">${event.description}</p>
                                <p class="text-xs italic text-gray-700">äº¤é€š: ${event.transport}</p>
                                ${mapButton}
                            </div>
                        </div>
                    `;
                });

                html += `</div></div>`;
            });

            document.getElementById('plan-page').innerHTML = html;
        }


        // ====================================================================
        // 2. GUIDE (æ·±åº¦å°è¦½) æ¸²æŸ“
        // ====================================================================

        const GUIDE_ARTICLES = [
            {
                title: "ğŸ›ï¸ å¤§è‹±åšç‰©é¤¨ï¼šäººé¡æ­·å²çš„ç¸®å½±",
                text: "å¤§è‹±åšç‰©é¤¨æ“æœ‰è¶…éå…«ç™¾è¬ä»¶è—å“ï¼Œæ˜¯ä¸–ç•Œä¸Šè¦æ¨¡æœ€å¤§ã€æœ€è‘—åçš„åšç‰©é¤¨ä¹‹ä¸€ã€‚å®ƒçš„å‰èº«æ˜¯æ¼¢æ–¯Â·æ–¯éš†çˆµå£«çš„ç§äººæ”¶è—ï¼Œæ–¼1759å¹´é–‹æ”¾ã€‚å¿…çœ‹å±•å“åŒ…æ‹¬ç¾…å¡å¡”çŸ³ç¢‘ã€åŸƒåŠæœ¨ä¹ƒä¼Šä»¥åŠå¸•å¾·å«©ç¥å»Ÿé›•å¡‘ç¾¤ã€‚**å†·çŸ¥è­˜ï¼š** åšç‰©é¤¨çš„åœ“å½¢é–±è¦½å®¤æ›¾æ˜¯é¦¬å…‹æ€å’Œåˆ—å¯§å¸¸å»çš„åœ°æ–¹ã€‚",
                mapHtml: ""
            },
            {
                title: "ğŸŒ‰ å€«æ•¦å¡”æ©‹ï¼šç¶­å¤šåˆ©äºæ™‚ä»£çš„å·¥è—å¥‡è¹Ÿ",
                text: "å€«æ•¦å¡”æ©‹ï¼ˆTower Bridgeï¼‰å¸¸è¢«èª¤èªç‚ºå€«æ•¦æ©‹ï¼Œå®ƒæ˜¯å€«æ•¦æœ€è‘—åçš„åœ°æ¨™ä¹‹ä¸€ã€‚é€™åº§çµåˆäº†æ‡¸ç´¢å’Œé–‹å•Ÿå¼åŠŸèƒ½çš„æ©‹æ¨‘æ–¼1894å¹´å®Œæˆï¼Œè¨­è¨ˆæ—¨åœ¨å…è¨±å¤§å‹èˆ¹éš»é€šéã€‚å¦‚ä»Šï¼Œä¸Šå±¤èµ°é“å·²æ”¹å»ºæˆç»ç’ƒæ­¥é“ï¼Œæä¾›ä¿¯ç°æ³°æ™¤å£«æ²³çš„åˆºæ¿€è¦–é‡ã€‚",
                mapHtml: ""
            },
            {
                title: "ğŸŒ³ æŸ¯èŠ¬åœ’ï¼šå¾ä¿®é“é™¢åˆ°è³¼ç‰©å¤©å ‚",
                text: "æŸ¯èŠ¬åœ’ï¼ˆCovent Gardenï¼‰éå»æ›¾æ˜¯èŠ±åœ’ï¼Œå¾Œä¾†æˆç‚ºä¿®é“é™¢çš„åœŸåœ°ï¼Œæœ€å¾Œç™¼å±•æˆè‘—åçš„æ°´æœå’Œè”¬èœå¸‚å ´ã€‚ç¾åœ¨å®ƒæ˜¯ä¸€å€‹å……æ»¿æ´»åŠ›çš„è³¼ç‰©å€ï¼Œæ“æœ‰è¨±å¤šç²¾å“åº—ã€å’–å•¡é¤¨å’Œè¡—é ­è—äººè¡¨æ¼”ã€‚ä¸»è¦çš„Market Buildingæ˜¯å¿…è¨ªä¹‹åœ°ã€‚",
                mapHtml: `<h4 class="text-xl font-display text-vintage-primary mt-6 mb-3">ğŸ“ OpenStreetMap å€åŸŸå°è¦½</h4><iframe class="w-full h-64 border-2 border-vintage-primary" src="https://www.openstreetmap.org/export/embed.html?bbox=-0.1264%2C51.5113%2C-0.1214%2C51.5143&layer=mapnik&marker=51.5128, -0.1239" style="border: 1px solid black;"></iframe>`
            }
        ];

        function renderGuidePage() {
            let html = `<h2 class="text-3xl font-display text-vintage-light mt-4 mb-6 border-b-2 border-vintage-accent pb-2">ğŸ“° æ·±åº¦å°è¦½ (GUIDE)</h2>`;

            GUIDE_ARTICLES.forEach(article => {
                html += `
                    <div class="vintage-card p-4 mb-6 shadow-xl">
                        <h3 class="text-2xl font-display text-vintage-primary mb-2">${article.title}</h3>
                        <p class="text-sm leading-relaxed text-gray-700">${article.text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}</p>
                        ${article.mapHtml}
                    </div>
                `;
            });

            document.getElementById('guide-page').innerHTML = html;
        }

        // ====================================================================
        // 3. WALLET (è¨˜å¸³èˆ‡åŒ¯ç‡) æ¸²æŸ“èˆ‡åŠŸèƒ½
        // ====================================================================

        function renderWalletPage() {
            loadData(); // é‡æ–°è®€å–è³‡æ–™ä»¥ç¢ºä¿æœ€æ–°
            let html = `
                <h2 class="text-3xl font-display text-vintage-light mt-4 mb-6 border-b-2 border-vintage-accent pb-2">ğŸ’° è¨˜å¸³èˆ‡åŒ¯ç‡</h2>

                <div class="vintage-card p-4 mb-6">
                    <h3 class="text-2xl font-display text-vintage-primary mb-3">åŒ¯ç‡æ›ç®—æ©Ÿ (Â£ to NTD)</h3>
                    <div class="flex items-center mb-4">
                        <label for="exchangeRate" class="text-sm font-semibold mr-2">ç›®å‰åŒ¯ç‡ (1Â£ = NT$):</label>
                        <input type="number" id="exchangeRate" value="${TRAVEL_DATA.exchangeRate}" step="0.1" class="w-20 p-1 border-2 border-vintage-primary rounded-md text-sm text-center">
                        <button onclick="updateExchangeRate()" class="vintage-button text-sm px-3 py-1 ml-2">å„²å­˜</button>
                    </div>

                    <div class="flex flex-col space-y-3">
                        <input type="text" id="calcInput" placeholder="è¼¸å…¥ç®—å¼: 500+200*3" class="w-full p-2 border-2 border-vintage-secondary rounded-md text-xl text-right font-mono">
                        <div class="grid grid-cols-4 gap-2">
                            <button onclick="calcAppend('7')" class="calc-btn">7</button>
                            <button onclick="calcAppend('8')" class="calc-btn">8</button>
                            <button onclick="calcAppend('9')" class="calc-btn">9</button>
                            <button onclick="calcAppend('/')" class="calc-btn">Ã·</button>

                            <button onclick="calcAppend('4')" class="calc-btn">4</button>
                            <button onclick="calcAppend('5')" class="calc-btn">5</button>
                            <button onclick="calcAppend('6')" class="calc-btn">6</button>
                            <button onclick="calcAppend('*')" class="calc-btn">Ã—</button>

                            <button onclick="calcAppend('1')" class="calc-btn">1</button>
                            <button onclick="calcAppend('2')" class="calc-btn">2</button>
                            <button onclick="calcAppend('3')" class="calc-btn">3</button>
                            <button onclick="calcAppend('-')" class="calc-btn">-</button>

                            <button onclick="calcClear()" class="calc-btn bg-red-400">C</button>
                            <button onclick="calcAppend('0')" class="calc-btn">0</button>
                            <button onclick="calcAppend('.')" class="calc-btn">.</button>
                            <button onclick="calcAppend('+')" class="calc-btn">+</button>
                        </div>
                        <button onclick="calculateAndConvert()" class="vintage-button text-lg p-2 mt-2 bg-green-600">
                            = è¨ˆç®— & æ›ç®— (NT$)
                        </button>
                        <p id="calcResult" class="text-center text-xl font-bold mt-3 text-vintage-primary"></p>
                    </div>
                </div>

                <div class="vintage-card p-4 mb-6">
                    <h3 class="text-2xl font-display text-vintage-primary mb-3">æ–°å¢æ¶ˆè²»</h3>
                    <div class="flex flex-col space-y-3">
                        <input type="text" id="expenseItem" placeholder="å“é … (ex: é–€ç¥¨, åˆé¤)" class="w-full p-2 border-2 border-vintage-secondary rounded-md">
                        <input type="number" id="expenseGbp" placeholder="è‹±éŠé‡‘é¡ (Â£)" class="w-full p-2 border-2 border-vintage-secondary rounded-md">

                        <input type="file" id="expensePhoto" accept="image/*" class="hidden" onchange="previewImage(event)">
                        <button onclick="document.getElementById('expensePhoto').click()" class="vintage-button bg-gray-500 hover:bg-gray-600 text-sm p-2">
                            <i class="fas fa-camera"></i> æ‹ç…§/ä¸Šå‚³æ”¶æ“š
                        </button>
                        <div id="imagePreviewContainer" class="text-center mt-2 hidden">
                            <p class="text-xs text-gray-500 mb-1">ç…§ç‰‡é è¦½ (å°‡è¢«å£“ç¸®)</p>
                            <img id="imagePreview" class="max-w-full max-h-40 mx-auto border border-gray-300 rounded-md">
                        </div>

                        <button onclick="addExpense()" class="vintage-button bg-blue-600 hover:bg-blue-700 p-2 mt-4">
                            <i class="fas fa-plus-circle"></i> å„²å­˜è¨˜å¸³
                        </button>
                    </div>
                </div>

                <div class="vintage-card p-4">
                    <h3 class="text-2xl font-display text-vintage-primary mb-3">è¨˜å¸³æ­·å²</h3>
                    <p class="text-sm mb-4">ç¸½æ”¯å‡º: <span id="totalGbp" class="font-bold text-lg text-red-600">Â£0.00</span> / <span id="totalTwd" class="font-bold text-lg text-red-600">NT$0</span></p>
                    <div id="expenseList" class="space-y-3">
                        </div>
                </div>
            `;
            document.getElementById('wallet-page').innerHTML = html;
            renderExpenseList();
            document.querySelectorAll('.calc-btn').forEach(btn => {
                btn.classList.add('p-2', 'bg-vintage-light', 'text-vintage-secondary', 'rounded-md', 'text-xl', 'font-bold', 'border', 'border-vintage-secondary');
            });
        }

        // --- åŒ¯ç‡æ›ç®—å™¨åŠŸèƒ½ ---
        function updateExchangeRate() {
            const rate = parseFloat(document.getElementById('exchangeRate').value);
            if (rate > 0) {
                TRAVEL_DATA.exchangeRate = rate;
                localStorage.setItem('travelApp_exchangeRate', rate);
                alert(`åŒ¯ç‡å·²æ›´æ–°: 1Â£ = NT$${rate}`);
                renderExpenseList(); // æ›´æ–°åˆ—è¡¨ä¸­çš„å°å¹£é‡‘é¡
            } else {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„åŒ¯ç‡ï¼');
            }
        }

        function calcAppend(value) {
            const input = document.getElementById('calcInput');
            input.value += value;
        }

        function calcClear() {
            document.getElementById('calcInput').value = '';
            document.getElementById('calcResult').textContent = '';
        }

        function calculateAndConvert() {
            const input = document.getElementById('calcInput').value;
            const resultDisplay = document.getElementById('calcResult');
            const rate = TRAVEL_DATA.exchangeRate;

            try {
                // ä½¿ç”¨ eval é€²è¡Œç®—å¼è¨ˆç®— (åƒ…ç”¨æ–¼ä¿¡ä»»çš„å®¢æˆ¶ç«¯è¼¸å…¥)
                // å°‡ x æ›¿æ›ç‚º * ç¢ºä¿å…¼å®¹æ€§
                const gbpAmount = eval(input.replace(/Ã—/g, '*').replace(/Ã·/g, '/')).toFixed(2);
                const twdAmount = (gbpAmount * rate).toFixed(0);

                resultDisplay.innerHTML = `Â£${gbpAmount} (è‹±éŠ) = **NT$${twdAmount} (å°å¹£)**`;
            } catch (error) {
                resultDisplay.textContent = 'è¨ˆç®—éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ç®—å¼ã€‚';
            }
        }

        // --- è¨˜å¸³åŠŸèƒ½æ ¸å¿ƒ ---

        let base64Image = null; // å„²å­˜å£“ç¸®å¾Œçš„ Base64 åœ–ç‰‡

        function previewImage(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const MAX_WIDTH = 200; // å£“ç¸®å¾Œçš„åœ–ç‰‡æœ€å¤§å¯¬åº¦
                    const scaleSize = MAX_WIDTH / img.width;
                    canvas.width = MAX_WIDTH;
                    canvas.height = img.height * scaleSize;

                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                    // å£“ç¸®ä¸¦è½‰ç‚º Base64 (JPEG, å“è³ª 0.7)
                    base64Image = canvas.toDataURL('image/jpeg', 0.7);

                    // é¡¯ç¤ºé è¦½
                    document.getElementById('imagePreview').src = base64Image;
                    document.getElementById('imagePreviewContainer').classList.remove('hidden');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function addExpense() {
            const item = document.getElementById('expenseItem').value.trim();
            const gbp = parseFloat(document.getElementById('expenseGbp').value);

            if (!item || isNaN(gbp) || gbp <= 0) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„å“é …å’Œé‡‘é¡ï¼');
                return;
            }

            const twd = (gbp * TRAVEL_DATA.exchangeRate).toFixed(0);

            const newExpense = {
                id: Date.now(),
                item: item,
                gbp: gbp.toFixed(2),
                twd: twd,
                image: base64Image
            };

            TRAVEL_DATA.expenses.unshift(newExpense); // æ–°å¢åˆ°åˆ—è¡¨æœ€å‰é¢
            saveData('expenses', TRAVEL_DATA.expenses);

            // æ¸…ç©ºè¡¨å–®å’Œé è¦½
            document.getElementById('expenseItem').value = '';
            document.getElementById('expenseGbp').value = '';
            document.getElementById('expensePhoto').value = '';
            document.getElementById('imagePreviewContainer').classList.add('hidden');
            base64Image = null;

            renderExpenseList();
        }

        function deleteExpense(id) {
            TRAVEL_DATA.expenses = TRAVEL_DATA.expenses.filter(exp => exp.id !== id);
            saveData('expenses', TRAVEL_DATA.expenses);
            renderExpenseList();
        }

        function renderExpenseList() {
            const listContainer = document.getElementById('expenseList');
            if (!listContainer) return; // ç¢ºä¿åœ¨æ­£ç¢ºçš„é é¢

            let totalGbp = 0;
            let totalTwd = 0;
            let listHtml = '';

            TRAVEL_DATA.expenses.forEach(exp => {
                totalGbp += parseFloat(exp.gbp);
                totalTwd += parseFloat(exp.twd);

                const imageHtml = exp.image
                    ? `<img src="${exp.image}" alt="æ”¶æ“šç¸®åœ–" class="w-16 h-16 object-cover rounded-md mr-3 border border-gray-300">`
                    : '<div class="w-16 h-16 bg-gray-200 rounded-md flex items-center justify-center text-gray-500 text-xs mr-3"><i class="fas fa-receipt text-xl"></i></div>';

                listHtml += `
                    <div class="flex justify-between items-start p-3 border-b border-vintage-accent bg-vintage-light rounded-lg shadow-inner">
                        <div class="flex items-start flex-grow">
                            ${imageHtml}
                            <div>
                                <p class="font-semibold text-base text-vintage-secondary">${exp.item}</p>
                                <p class="text-xs text-gray-600">æ™‚é–“: ${new Date(exp.id).toLocaleDateString('zh-TW')} ${new Date(exp.id).toLocaleTimeString('zh-TW')}</p>
                            </div>
                        </div>
                        <div class="text-right flex-shrink-0 ml-2">
                            <p class="font-bold text-red-600 text-lg">Â£${exp.gbp}</p>
                            <p class="text-sm text-gray-700">NT$${exp.twd}</p>
                            <button onclick="deleteExpense(${exp.id})" class="text-red-400 hover:text-red-600 text-xs mt-1"><i class="fas fa-trash-alt"></i> åˆªé™¤</button>
                        </div>
                    </div>
                `;
            });

            listContainer.innerHTML = listHtml || '<p class="text-center text-gray-500 italic">ç›®å‰æ²’æœ‰è¨˜å¸³ç´€éŒ„ã€‚</p>';
            document.getElementById('totalGbp').textContent = `Â£${totalGbp.toFixed(2)}`;
            document.getElementById('totalTwd').textContent = `NT$${totalTwd.toFixed(0)}`;
        }


        // ====================================================================
        // 4. LISTS (æ¸…å–®) æ¸²æŸ“èˆ‡åŠŸèƒ½
        // ====================================================================

        function renderListsPage() {
            loadData();
            let html = `
                <h2 class="text-3xl font-display text-vintage-light mt-4 mb-6 border-b-2 border-vintage-accent pb-2">ğŸ“‹ æ¸…å–®èˆ‡å‚™å¿˜éŒ„</h2>

                <div class="vintage-card p-4 mb-6">
                    <h3 class="text-2xl font-display text-vintage-primary mb-3">è¡Œå‰æº–å‚™ CheckList</h3>
                    <div id="checkListContainer" class="space-y-2">
                        </div>
                </div>

                <div class="vintage-card p-4">
                    <h3 class="text-2xl font-display text-vintage-primary mb-3">å€‹äººå‚™å¿˜éŒ„</h3>
                    <div class="flex mb-3">
                        <input type="text" id="memoInput" placeholder="è¼¸å…¥å‚™å¿˜äº‹é …æˆ–ç¶²å€" class="flex-grow p-2 border-2 border-vintage-secondary rounded-l-md">
                        <button onclick="addMemo()" class="vintage-button bg-blue-600 px-3 rounded-r-md rounded-l-none">æ–°å¢</button>
                    </div>
                    <div id="memoListContainer" class="space-y-2">
                        </div>
                </div>
            `;
            document.getElementById('lists-page').innerHTML = html;
            renderCheckList();
            renderMemoList();
        }

        // --- CheckList åŠŸèƒ½ ---
        function toggleCheckListItem(id) {
            const item = TRAVEL_DATA.checkList.find(i => i.id === id);
            if (item) {
                item.done = !item.done;
                saveData('checkList', TRAVEL_DATA.checkList);
                renderCheckList();
            }
        }

        function renderCheckList() {
            const container = document.getElementById('checkListContainer');
            if (!container) return;

            container.innerHTML = TRAVEL_DATA.checkList.map(item => `
                <div class="flex items-center p-2 bg-gray-100 rounded-md hover:bg-gray-200 transition duration-150 ease-in-out">
                    <input type="checkbox" id="check-${item.id}" ${item.done ? 'checked' : ''} onchange="toggleCheckListItem(${item.id})" class="form-checkbox h-5 w-5 text-vintage-primary border-gray-300 rounded focus:ring-0 cursor-pointer">
                    <label for="check-${item.id}" class="ml-3 text-base ${item.done ? 'line-through text-gray-500 italic' : 'font-medium text-vintage-secondary'} flex-grow cursor-pointer">${item.text}</label>
                </div>
            `).join('');
        }

        // --- å‚™å¿˜éŒ„åŠŸèƒ½ ---
        function addMemo() {
            const input = document.getElementById('memoInput');
            const text = input.value.trim();
            if (text) {
                TRAVEL_DATA.memos.unshift({ id: Date.now(), text: text });
                saveData('memos', TRAVEL_DATA.memos);
                input.value = '';
                renderMemoList();
            }
        }

        function deleteMemo(id) {
            TRAVEL_DATA.memos = TRAVEL_DATA.memos.filter(memo => memo.id !== id);
            saveData('memos', TRAVEL_DATA.memos);
            renderMemoList();
        }

        function renderMemoList() {
            const container = document.getElementById('memoListContainer');
            if (!container) return;

            container.innerHTML = TRAVEL_DATA.memos.map(memo => {
                // æª¢æŸ¥æ˜¯å¦ç‚ºç¶²å€
                const urlRegex = /^(https?:\/\/[^\s]+)$/i;
                const isUrl = urlRegex.test(memo.text);

                const content = isUrl
                    ? `<a href="${memo.text}" target="_blank" class="vintage-button bg-green-500 text-sm px-3 py-1 mt-1 inline-block"><i class="fas fa-link"></i> é–‹å•Ÿé€£çµ</a>`
                    : `<p class="text-sm">${memo.text}</p>`;

                return `
                    <div class="flex justify-between items-start p-2 bg-gray-100 rounded-md border-l-4 border-vintage-accent">
                        <div class="flex-grow pr-2">
                            ${isUrl ? `<p class="text-sm font-semibold text-blue-700 truncate">${memo.text}</p>` : content}
                            ${isUrl ? content : ''}
                        </div>
                        <button onclick="deleteMemo(${memo.id})" class="text-red-400 hover:text-red-600 text-lg"><i class="fas fa-times-circle"></i></button>
                    </div>
                `;
            }).join('');
        }

        // ====================================================================
        // 5. INFO (è³‡è¨Š) æ¸²æŸ“
        // ====================================================================

        function renderInfoPage() {
            const infoData = {
                weatherLink: "https://www.metoffice.gov.uk/", // è‹±åœ‹æ°£è±¡å»³
                emergency: [
                    { service: "è­¦å¯Ÿ/æ•‘è­·è»Š/æ¶ˆé˜²", number: "999 æˆ– 112", description: "ç·Šæ€¥æƒ…æ³æ’¥æ‰“" },
                    { service: "éç·Šæ€¥é†«ç™‚å°ˆç·š", number: "111", description: "éœ€è¦é†«ç™‚å»ºè­°ä½†éç·Šæ€¥" },
                    { service: "éç·Šæ€¥è­¦å¯Ÿ", number: "101", description: "éç·Šæ€¥çŠ¯ç½ªèˆ‰å ±" },
                    { service: "é§è‹±åœ‹è‡ºåŒ—ä»£è¡¨è™•", number: "+44 (0)20 7881 2050", description: "æ€¥é›£æ•‘åŠ©é›»è©±" },
                ],
                taboos: [
                    "ç¦®å„€ï¼šåœ¨è‹±åœ‹ï¼Œã€è«‹ (Please)ã€ã€ã€è¬è¬ (Thank you)ã€å’Œã€å°ä¸èµ· (Sorry)ã€æ˜¯å¿…é ˆçš„ã€‚",
                    "å°è²»ï¼šé€šå¸¸æœƒåœ¨é¤å»³çµ¦äºˆ10-15%çš„å°è²»ï¼ˆè‹¥å¸³å–®æœªåŒ…å«æœå‹™è²»ï¼‰ã€‚",
                    "æ’éšŠï¼šè‹±åœ‹äººéå¸¸é‡è¦–æ’éšŠï¼ˆQueueï¼‰çš„æ–‡åŒ–ï¼Œè«‹å‹¿æ’éšŠã€‚",
                    "äº¤é€šï¼šè¡Œäººå’Œé§•é§›çš†é å·¦è¡Œï¼Œéé¦¬è·¯æ™‚è«‹å…ˆçœ‹å³é‚Šï¼Œå†çœ‹å·¦é‚Šã€‚",
                    "é•ç¦å“ï¼šåš´ç¦æ”œå¸¶è‚‰è£½å“ã€ä¹³è£½å“ã€æ¤ç‰©ã€æ§æã€æ¯’å“ç­‰é€²å…¥è‹±åœ‹ã€‚",
                ]
            };

            let html = `
                <h2 class="text-3xl font-display text-vintage-light mt-4 mb-6 border-b-2 border-vintage-accent pb-2">â„¹ï¸ ç•¶åœ°é‡è¦è³‡è¨Š</h2>

                <div class="vintage-card p-4 mb-6 text-center">
                    <h3 class="text-2xl font-display text-vintage-primary mb-3">ç•¶åœ°å¤©æ°£é å ±</h3>
                    <a href="${infoData.weatherLink}" target="_blank" class="vintage-button bg-orange-600 text-lg px-6 py-2">
                        <i class="fas fa-cloud-sun"></i> æŸ¥çœ‹è‹±åœ‹æ°£è±¡å»³
                    </a>
                </div>

                <div class="vintage-card p-4 mb-6">
                    <h3 class="text-2xl font-display text-vintage-primary mb-3">ç·Šæ€¥è¯çµ¡è³‡è¨Š</h3>
                    <div class="space-y-3">
                        ${infoData.emergency.map(item => `
                            <div class="border-b pb-2 border-vintage-accent">
                                <p class="font-bold text-lg">${item.service}: <a href="tel:${item.number.replace(/\s/g, '')}" class="text-blue-600 hover:text-blue-800">${item.number}</a></p>
                                <p class="text-sm text-gray-600">${item.description}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div class="vintage-card p-4">
                    <h3 class="text-2xl font-display text-vintage-primary mb-3">æ—…éŠæ³¨æ„äº‹é …</h3>
                    <ul class="list-disc pl-5 space-y-2 text-sm text-gray-700">
                        ${infoData.taboos.map(item => `
                            <li class="border-l-4 border-vintage-accent pl-2">${item}</li>
                        `).join('')}
                    </ul>
                </div>
            `;
            document.getElementById('info-page').innerHTML = html;
        }

        // ====================================================================
        // åˆå§‹åŒ–
        // ====================================================================

        document.addEventListener('DOMContentLoaded', () => {
            loadData(); // è¼‰å…¥ LocalStorage è³‡æ–™
            switchTab('plan-page'); // é è¨­é¡¯ç¤ºè¡Œç¨‹è¡¨
        });
    </script>
</body>
</html>